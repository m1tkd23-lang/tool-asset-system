<!-- templates/parts_detail.html -->
{% extends "base.html" %}
{% block content %}

<h2>Part Detail</h2>

<div class="detail-actions">
    <a class="btn-link" href="{{ url_for('parts.part_edit', asset_code=part.asset_code) }}">Edit</a>

    {% if part.status != "ARCHIVED" %}
    <form method="post" action="{{ url_for('parts.part_archive', asset_code=part.asset_code) }}"
        onsubmit="return confirm('Archive this part?');">
        <button type="submit" class="btn">Archive</button>
    </form>
    {% else %}
    <form method="post" action="{{ url_for('parts.part_restore', asset_code=part.asset_code) }}"
        onsubmit="return confirm('Restore this part to ACTIVE?');">
        <button type="submit" class="btn">Restore</button>
    </form>
    {% endif %}
</div>

<hr>

<div class="detail-grid">
    <!-- Left: Part meta -->
    <section class="panel">
        <table class="kv-table">
            <tbody>
                <tr>
                    <th>asset_code</th>
                    <td><code>{{ part.asset_code }}</code></td>
                </tr>

                <tr>
                    <th>layer</th>
                    <td>
                        {{ part.layer_code }}
                        {% set ll = layer_labels.get(part.layer_code, "") %}
                        {% if ll %} / {{ ll }}{% endif %}
                    </td>
                </tr>
                <tr>
                    <th>category</th>
                    <td>
                        {% if part.category_code %}
                        {{ part.category_code }}
                        {% set cl = category_labels.get(part.category_code, "") %}
                        {% if cl %} / {{ cl }}{% endif %}
                        {% else %}
                        (free)
                        {% endif %}

                        {% if part.category_free_text %}
                        <span class="badge">{{ part.category_free_text }}</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>status</th>
                    <td>
                        {{ part.status }}
                        {% set sl = status_labels.get(part.status, "") %}
                        {% if sl %} / {{ sl }}{% endif %}
                    </td>
                </tr>

                <tr>
                    <th>maker</th>
                    <td>{{ part.maker }}</td>
                </tr>
                <tr>
                    <th>part_no</th>
                    <td>{{ part.part_no }}</td>
                </tr>
                <tr>
                    <th>maker_part_name</th>
                    <td>{{ part.maker_part_name or "-" }}</td>
                </tr>
                <tr>
                    <th>display_name</th>
                    <td>{{ part.display_name }}</td>
                </tr>

                <tr>
                    <th>stock</th>
                    <td>{{ part.stock_qty }} {{ part.stock_unit }}</td>
                </tr>
                <tr>
                    <th>pack_qty</th>
                    <td>{{ part.pack_qty or "-" }}</td>
                </tr>
                <tr>
                    <th>unit_price</th>
                    <td>{{ part.unit_price or "-" }}</td>
                </tr>
                <tr>
                    <th>supplier</th>
                    <td>{{ part.supplier or "-" }}</td>
                </tr>
                <tr>
                    <th>lead_time_days</th>
                    <td>{{ part.lead_time_days or "-" }}</td>
                </tr>
                <tr>
                    <th>min_stock_qty</th>
                    <td>{{ part.min_stock_qty or "-" }}</td>
                </tr>

                <tr>
                    <th>note</th>
                    <td>{{ part.note or "-" }}</td>
                </tr>

                <tr>
                    <th>created_at</th>
                    <td>{{ part.created_at }}</td>
                </tr>
                <tr>
                    <th>updated_at</th>
                    <td>{{ part.updated_at }}</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- Right: Logs -->
    <section class="panel">
        <div class="panel-header">
            <h3>Operation Logs</h3>
        </div>

        {% if logs and logs|length > 0 %}
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        {% for k in logs[0].keys() %}
                        <th>{{ k }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for r in logs %}
                    <tr>
                        {% for k in r.keys() %}
                        <td>{{ r[k] }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-muted">No logs for this part.</div>
        {% endif %}
    </section>
</div>

{% endblock %}