<!--src/tool_asset_system/web/templates/tooling_lists_new.html-->
{% extends "base.html" %}
{% block content %}

<h2>New Tooling List</h2>

<div class="panel">
    <div class="panel-header">
        <h3>Pick assemblies (filter)</h3>
    </div>

    <form method="get" id="asm_filter_form" class="filter-form" style="margin-bottom:10px;">
        <label>Search:
            <input type="search" name="q" class="q-input" value="{{ current.q or '' }}" placeholder="code/name/note"
                autocomplete="off">
        </label>
        <div class="filter-search">
            <button type="submit">Search</button>
        </div>
    </form>
</div>

<div style="height:12px;"></div>

<form method="post" id="tl_new_form">
    <div class="panel">
        <div class="panel-header">
            <h3>List meta</h3>
        </div>

        <div class="edit-form meta-form">
            <label>Title:
                <input type="text" name="title" value="{{ form.get('title','') }}" placeholder="例：MOX缶 Rib加工 1st">
            </label>

            <label class="edit-note">Note:
                <textarea name="note" rows="3">{{ form.get('note','') }}</textarea>
            </label>
        </div>
    </div>

    <div style="height:12px;"></div>

    <div class="panel">
        <div class="panel-header">
            <h3>Pick assemblies</h3>
        </div>

        <p class="text-muted" style="margin:0 0 10px;">
            使いたい ASM にチェック → tool_no（ポケット番号）を入力 → 「Create List」。
        </p>

        <div class="table-scroll">
            <table class="pick-asm-table">
                <thead>
                    <tr>
                        <th style="width:34px;"></th>
                        <th>assembly_code</th>
                        <th style="min-width:160px;">tool_no</th>
                        <th style="width:90px;">qty</th>
                        <th>display_name</th>
                        <th>tool_diameter</th>
                        <th>tool_overall_length</th>
                        <th>updated_at</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in asm_rows %}
                    <tr data-assembly-code="{{ r.assembly_code }}">
                        <td><input type="checkbox" class="pick-check" data-ac="{{ r.assembly_code }}"></td>
                        <td><code>{{ r.assembly_code }}</code></td>

                        <td>
                            <input type="text" class="pick-toolno" data-ac="{{ r.assembly_code }}"
                                name="tool_no_{{ r.assembly_code }}" placeholder="01 / 100 / T12"
                                value="{{ form.get('tool_no_' ~ r.assembly_code, '') }}">
                        </td>

                        <td>
                            <input type="number" step="0.001" class="pick-qty" data-ac="{{ r.assembly_code }}"
                                name="qty_{{ r.assembly_code }}" value="{{ form.get('qty_' ~ r.assembly_code, '1') }}">
                        </td>

                        <td>{{ r.display_name }}</td>
                        <td>{{ r.tool_diameter or '' }}</td>
                        <td>{{ r.tool_overall_length or '' }}</td>
                        <td>{{ r.updated_at }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="selected-asm-hidden"></div>

    <div class="detail-actions">
        <button type="submit" class="btn" name="action" value="create">Create List</button>
        <a class="btn-link" href="{{ url_for('tooling_lists.tooling_lists_list') }}">Back</a>
    </div>
</form>

<script src="{{ url_for('static', filename='tooling_lists_new.js') }}"></script>

{% endblock %}